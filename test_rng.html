<!DOCTYPE html>
<html>
<head><title>Test RNG</title></head>
<body>
<pre id="output"></pre>
<script>
class SeededRandom {
    constructor(seed) {
        this.seed = seed >>> 0;
        this.mt = new Array(624);
        this.mti = 625;
        this.init(this.seed);
    }

    init(seed) {
        this.mt[0] = seed >>> 0;
        for (let i = 1; i < 624; i++) {
            const s = this.mt[i - 1] ^ (this.mt[i - 1] >>> 30);
            this.mt[i] = (((((s & 0xffff0000) >>> 16) * 1812433253) << 16) +
                (s & 0x0000ffff) * 1812433253 + i) >>> 0;
        }
        this.mti = 624;
    }

    next() {
        let y;
        const mag01 = [0x0, 0x9908b0df];

        if (this.mti >= 624) {
            let kk;
            for (kk = 0; kk < 624 - 397; kk++) {
                y = (this.mt[kk] & 0x80000000) | (this.mt[kk + 1] & 0x7fffffff);
                this.mt[kk] = this.mt[kk + 397] ^ (y >>> 1) ^ mag01[y & 0x1];
            }
            for (; kk < 624 - 1; kk++) {
                y = (this.mt[kk] & 0x80000000) | (this.mt[kk + 1] & 0x7fffffff);
                this.mt[kk] = this.mt[kk + (397 - 624)] ^ (y >>> 1) ^ mag01[y & 0x1];
            }
            y = (this.mt[623] & 0x80000000) | (this.mt[0] & 0x7fffffff);
            this.mt[623] = this.mt[396] ^ (y >>> 1) ^ mag01[y & 0x1];
            this.mti = 0;
        }

        y = this.mt[this.mti++];
        y ^= (y >>> 11);
        y ^= (y << 7) & 0x9d2c5680;
        y ^= (y << 15) & 0xefc60000;
        y ^= (y >>> 18);

        return (y >>> 0) / 4294967296;
    }

    normal(mean = 0, sd = 1) {
        const u1 = this.next();
        const u2 = this.next();
        const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
        return mean + z0 * sd;
    }
}

const rng = new SeededRandom(123);
let output = 'First 10 normals:\n';
for (let i = 0; i < 10; i++) {
    output += rng.normal().toFixed(7) + '\n';
}

output += '\nNext 10 normals:\n';
for (let i = 0; i < 10; i++) {
    output += rng.normal().toFixed(7) + '\n';
}

const rng2 = new SeededRandom(123);
// Skip 20 normals
for (let i = 0; i < 20; i++) rng2.normal();

output += '\nFirst 4 runif adjustments:\n';
for (let i = 0; i < 4; i++) {
    output += (rng2.next() * 16 - 8).toFixed(6) + '\n';
}

output += '\nNext 4 runif multipliers:\n';
for (let i = 0; i < 4; i++) {
    output += (rng2.next() * 0.6 + 0.8).toFixed(7) + '\n';
}

document.getElementById('output').textContent = output;
</script>
</body>
</html>
